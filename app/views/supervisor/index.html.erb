<% if supervisor?(current_user[:id])%>
    <h1>Tickets de Atraccion </h1>

    <% if !current_user[:atraccion].nil? %>
			<% @atr = Atraccion.find(current_user[:atraccion]) %>
			<%@count = 0%>
			<h1><%=@atr.nombre_atc%>
				<%if @atr.pause == false%>
					<%=link_to "Pausar <i class='fas fa-pause'></i>".html_safe ,{controller: "supervisor", action:"pausar", atc: @atr.id}, class: "btn btn-outline-warning"%>
				<% else %>
					<%=link_to "Iniciar <i class='fas fa-play'></i>".html_safe ,{controller: "supervisor", action:"play", atc: @atr.id}, class: "btn btn-outline-warning"%>
				<% end %>
			</h1>
	<div class="container-cola " >
		<div class="wrap-cola ">
			<h2 style="text-align:center;"> Lista de usuarios </h2>
				<div class="barra3 container">
					<table>
								<thead>
									<tr>
										<th>Numero</th>
										<th>Estado</th>
										<th>Servicio</th>
										<th>Omitir</th>
										<th>Contactar</th>
									</tr>
								</thead>
								<tbody>
						<% @supervisor.each do |sp| %>
										<% @tktest = TicketEstado.where("tickets_id = #{sp.tickets_id}").last %>
										<% @est = Estado.find(@tktest.estados_id)  %>
											<%if @count < @atr.capacidad_atc %>
												<%if @est.id != 4 && @est.id != 5 && @est.id != 3%>
													<tr>
														<td><input type="text" value="<%= sp.tickets_id %>" class="ticket"/><%= sp.tickets_id %></td>
														<td><%= @est.descripcion_est %></td>
														<%if @est.id == 2%>
															<td><%= link_to "Servido", {controller: "supervisor", action: "cambiar_estado", estado: 3, ticket: sp.tickets_id } %></td>
														<%else%>
															<td>En Espera</td>
														<%end%>
														<td><%= link_to "Omitir", {controller: "supervisor", action: "cambiar_estado", estado: 4, ticket: sp.tickets_id } %></td>
														<%@user = User.find(sp.users_id)%>
														<%if @est.id == 1%>
														<input type="hidden" value="<%=@user.id%>" class="users" >
														<td><%= link_to "Contactar", {controller: "supervisor", action: "llamar", id: @user.id, atc: @atr.id, estado: 2 , ticket: sp.tickets_id} %></td>
														<%else%>
															<td>Contactado</td>
														<%end%>
													</tr>
													<%@count += 1%>
												<% end %>
											<%end%>
						<% end %>
								</tbody>
				
					</table>

					<form>
						<input type="hidden" name="tickets_id" id="intTicket">
						<input type="submit" value="Llamar a servicio" class="btn btn-primary">
					</form>
						<br>
					<form>
						<input type="hidden" name="tickets_id" id="intTicket">
						<input type="submit" value="Servido" class="btn btn-primary">
					</form>
						<br>
					<form action="<%=supervisor_masivo_path%>" method="get">
						<input type="hidden" name="usuarios" id="intUser">
						<input type="hidden" name="atc" value="<%=@atr.id%>">
						<input type="submit" value="Contactar a Todos" class="btn btn-primary">
					</form>
				</div>
		</div>
	</div>		
    <% else %>  
        <h3> Sin atraccion asignada </h3>
    <% end %>   

<% end %>

<script>
	
	var inputs = document.getElementsByClassName("ticket")
	var inputs2 = document.getElementsByClassName("users")
	var valores = ''
	var usuarios = ''
	var i = 0
	var e = 0

	function set_ticket() {

		for (i; i >= inputs.length; i++ ){

			if(i === 0){
    		valores = inputs[i].value
			} else {
				valores = valores +',' + inputs[i].value
			}

		}
		document.getElementById("intTicket").value = valores
	}

	function set_users() {

		for (e; e >= inputs2.length; e++ ){

			if(e === 0){
    		usuarios = inputs2[e].value
			} else {
				usuarios = usuarios +',' + inputs2[e].value
			}

		}
		document.getElementById("intUser").value = usuarios
	}

	setInterval(set_ticket,500)
	setInterval(set_users,500)

</script>